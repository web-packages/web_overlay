!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Overlay={})}(this,(function(t){"use strict";class e extends HTMLElement{constructor(){super(...arguments),this.isMarkNeedRepaint=!0}get raw(){return this.firstElementChild}get targetRect(){return this.target instanceof HTMLElement?this.target.getBoundingClientRect():this.target}get viewportRect(){return this.parent.getBoundingClientRect()}get animation(){return this.behavior.animation}markNeedRepaint(){this.unsetLayout(),this.performLayout()}unsetLayout(){this.style.width="max-content",this.style.height="max-content",this.style.left="0px",this.style.top="0px",this.getBoundingClientRect()}disconnectedCallback(){this.isMarkNeedRepaint=!1,window.removeEventListener("resize",this.markNeedRepaint.bind(this)),window.removeEventListener("scroll",this.markNeedRepaint.bind(this))}connectedCallback(){var t;if(this.style.display="block",this.style.position="fixed",this.style.left="0px",this.style.top="0px",this.style.width="max-content",this.style.height="max-content",this.performLayout(),this.target instanceof HTMLElement){const t=()=>{this.isMarkNeedRepaint&&(this.markNeedRepaint(),requestAnimationFrame(t))};requestAnimationFrame(t)}window.addEventListener("resize",this.markNeedRepaint.bind(this)),window.addEventListener("scroll",this.markNeedRepaint.bind(this)),(null===(t=this.animation)||void 0===t?void 0:t.fadein)&&queueMicrotask((()=>this.fadein()))}detach(t){var e;if(null===(e=this.animation)||void 0===e?void 0:e.fadeout)return this.fadeout(),this.onanimationend=()=>this.parent.removeChild(this),void(t&&t());this.parent.removeChild(this)}fadein(){this.style.animation=this.animation.fadein}fadeout(){this.style.animation=this.animation.fadeout}performLayout(){var t;if(this.target instanceof HTMLElement){const t=getComputedStyle(this.target);"none"!=t.display&&"contents"!=t.display||this.remove()}const e=this.behavior.direction.performLayout(this),o=e.modifiedRect;this.style.width=`${o.width}px`,this.style.height=`${o.height}px`,this.style.left=`${o.x}px`,this.style.top=`${o.y}px`,null===(t=this.behavior.onLayoutBehind)||void 0===t||t.call(this.raw,e)}}customElements.define("overlay-layout",e);class o{constructor(t){this.viewport=t}}class i extends o{overflowed(t){const e=this.viewport,o=window.innerWidth-(t.x+t.width),i=window.innerWidth-this.viewport.right;return{left:Math.max(e.left-t.x,0),right:Math.max(i-o,0),top:Math.max(e.top-t.y,0),bottom:Math.max(t.y+t.height-e.bottom,0)}}}class r{static merge(t,e){var o,i,r,n;return new DOMRect(null!==(o=e.x)&&void 0!==o?o:t.x,null!==(i=e.y)&&void 0!==i?i:t.y,null!==(r=e.width)&&void 0!==r?r:t.width,null!==(n=e.height)&&void 0!==n?n:t.height)}static reflowHorizontal(t,e){return t.style.left=`${e.left}px`,t.style.top=`${e.top}px`,t.style.width=`${e.width}px`,t.style.height=null,t.getBoundingClientRect()}static reflowVertical(t,e){return t.style.left=`${e.left}px`,t.style.top=`${e.top}px`,t.style.width=null,t.style.height=`${e.height}px`,t.getBoundingClientRect()}static applyPadding(t,e){return new DOMRect(t.x+e,t.y+e,t.width-2*e,t.height-2*e)}}var n;!function(t){t.NONE="none",t.REFLOW="reflow",t.REFLOW_REPOSITION="reflow_reposition"}(n||(n={}));class a{constructor(t){this.parent=t,t&&(this.parent.child=this)}performLayout(t,e,o,i){const r=this.performLayoutHorizontal(t,e,o,i);return this.performLayoutVertical(t,r,o,i)}}class s extends a{constructor(t=n.NONE){super(),this.overflowBehavior=t}performLayoutVertical(t,e,o,i){let a=o.overflowed(e),s=!1,l=!1;return a.bottom&&(e=r.merge(e,{height:Math.max(e.height-a.bottom,0)}),s=!0,l=!0),a.top&&(e=r.merge(e,{y:e.y+a.top,height:e.height-a.top}),s=!0,l=!0),(s&&this.overflowBehavior==n.REFLOW||this.overflowBehavior==n.REFLOW_REPOSITION)&&(e=r.reflowVertical(t,e)),l&&this.overflowBehavior==n.REFLOW_REPOSITION&&(e=r.merge(e,{x:i(e).x})),e}performLayoutHorizontal(t,e,o,i){let n=o.overflowed(e),a=!1;return n.left&&(e=r.merge(e,{x:e.x+n.left,width:e.width-n.left}),e=r.reflowHorizontal(t,e),a=!0),n.right&&(e=r.merge(e,{width:e.width-n.right}),e=r.reflowHorizontal(t,e),a=!0),a&&(e=r.merge(e,{y:i(e).y})),e}}class l extends a{performLayoutVertical(t,e,o,i){var n,a;let s=o.overflowed(e),l=!1;return s.bottom?(e=r.merge(e,{y:e.y-s.bottom}),s=o.overflowed(e),s.top&&(l=!0)):s.top&&(e=r.merge(e,{y:e.y+s.top}),s=o.overflowed(e),s.bottom&&(l=!0)),l&&null!==(a=null===(n=this.parent)||void 0===n?void 0:n.performLayoutVertical(t,e,o,i))&&void 0!==a?a:e}performLayoutHorizontal(t,e,o,i){var n,a;let s=o.overflowed(e),l=!1;return s.left?(e=r.merge(e,{x:e.x+s.left}),s=o.overflowed(e),s.right&&(l=!0)):s.right&&(e=r.merge(e,{x:e.x-s.right}),s=o.overflowed(e),s.left&&(l=!0)),l&&null!==(a=null===(n=this.parent)||void 0===n?void 0:n.performLayoutHorizontal(t,e,o,i))&&void 0!==a?a:e}}class h{}class d extends h{createOverlayConstraint(t){return new i(t)}performLayout(t){var e,o,i;const n=t.getBoundingClientRect(),s=t.targetRect,l=t.viewportRect,h=t.behavior,d=null!==(e=h.alignment)&&void 0!==e?e:O.ALL,u=null!==(o=h.targetGap)&&void 0!==o?o:0,y=null!==(i=h.viewportPadding)&&void 0!==i?i:0,c=t=>this.perfromLayoutPosition(t,s,u),p=r.merge(n,c(n)),f=this.createOverlayConstraint(r.applyPadding(l,y));let m=p;if(d instanceof a)m=d.performLayout(t,p,f,c);else{console.assert(null!=d.horizontal),console.assert(null!=d.vertical);const e=d.horizontal.performLayoutHorizontal(t,p,f,c);m=d.vertical.performLayoutVertical(t,e,f,c)}return{initialRect:p,modifiedRect:m}}}class u extends d{perfromLayoutPosition(t,e,o){return{x:this.getPositionHorizontal(t,e,o),y:e.y+(e.height-t.height)/2}}}class y extends d{perfromLayoutPosition(t,e,o){return{x:e.x+(e.width-t.width)/2,y:this.getPositionVertical(t,e,o)}}}class c extends y{getPositionVertical(t,e,o){return e.bottom+o}}class p extends d{perfromLayoutPosition(t,e,o){return{x:e.right-t.width,y:e.bottom+o}}}class f extends d{perfromLayoutPosition(t,e,o){return{x:e.left,y:e.bottom+o}}}class m extends y{getPositionVertical(t,e,o){return e.top-t.height-o}}class v extends d{perfromLayoutPosition(t,e,o){return{x:e.right-t.width,y:e.y-t.height-o}}}class g extends d{perfromLayoutPosition(t,e,o){return{x:e.left,y:e.top-t.height-o}}}class w extends u{getPositionHorizontal(t,e,o){return e.left-t.width-o}}class x extends u{getPositionHorizontal(t,e,o){return e.right+o}}const L={BOTTOM_CENTER:new c,BOTTOM_RIGHT:new f,BOTTOM_LEFT:new p,TOP_CENTER:new m,TOP_RIGHT:new g,TOP_LEFT:new v,LEFT:new w,RIGHT:new x},O={ALL:new l(new s),NONE:new class extends a{performLayoutVertical(t,e){return e}performLayoutHorizontal(t,e){return e}},SIZE:new s,POSITION:new l};class R{static attach({element:t,target:e,parent:o,behavior:i}){if(null==t)throw new Error("todo");if(null==e)throw new Error("todo");if(null==o)throw new Error("todo");const r=document.createElement("overlay-layout");return r.append(t),r.target=e,r.parent=o,r.behavior=null!=i?i:R.defaultBehavior,this.overlays.set(t,r),o.append(r),r}static detach(t,e){t.detach(e)}static at({element:t,parent:e,behavior:o,position:i}){const r=document.createElement("overlay-layout");return r.append(t),r.target=new DOMRect(i.x,i.y),r.parent=null!=e?e:document.body,r.behavior=null!=o?o:R.defaultBehavior,this.overlays.set(t,r),e.append(r),r}}R.overlays=new Map,R.defaultBehavior={direction:L.BOTTOM_CENTER},t.BottomCenterOverlayLayout=c,t.BottomLeftOverlayLayout=p,t.BottomRightOverlayLayout=f,t.DrivenOverlayLayout=d,t.HorizontalCenterOverlayLayout=y,t.LeftOverlayLayout=w,t.Overlay=R,t.OverlayAlignment=O,t.OverlayDirection=L,t.OverlayElement=e,t.OverlayLayout=h,t.RightOverlayLayout=x,t.TopCenterOverlayLayout=m,t.TopLeftOverlayLayout=v,t.TopRightOverlayLayout=g,t.VerticalCenterOverlayLayout=u}));
//# sourceMappingURL=index.umd.js.map
