!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Overlay={})}(this,(function(t){"use strict";class e{constructor(t){this.viewport=t}}class r extends e{overflowed(t){const e=this.viewport,r=window.innerWidth-(t.x+t.width),i=window.innerWidth-this.viewport.right;return{left:Math.max(e.left-t.x,0),right:Math.max(i-r,0),top:Math.max(e.top-t.y,0),bottom:Math.max(t.y+t.height-e.bottom,0)}}}class i{static merge(t,e){var r,i,o,n;return new DOMRect(null!==(r=e.x)&&void 0!==r?r:t.x,null!==(i=e.y)&&void 0!==i?i:t.y,null!==(o=e.width)&&void 0!==o?o:t.width,null!==(n=e.height)&&void 0!==n?n:t.height)}static reflowHorizontal(t,e){return t.style.left=`${e.left}px`,t.style.top=`${e.top}px`,t.style.width=`${e.width}px`,t.style.height=null,t.getBoundingClientRect()}static reflowVertical(t,e){return t.style.left=`${e.left}px`,t.style.top=`${e.top}px`,t.style.width=null,t.style.height=`${e.height}px`,t.getBoundingClientRect()}static applyPadding(t,e){return new DOMRect(t.x+e,t.y+e,t.width-2*e,t.height-2*e)}}var o;!function(t){t.NONE="none",t.REFLOW="reflow",t.REFLOW_REPOSITION="reflow_reposition"}(o||(o={}));class n{constructor(t){this.parent=t,t&&(this.parent.child=this)}performLayout(t,e,r,i){const o=this.performLayoutHorizontal(t,e,r,i);return this.performLayoutVertical(t,o,r,i)}}class s extends n{constructor(t=o.NONE){super(),this.overflowBehavior=t}performLayoutVertical(t,e,r,n){let s=r.overflowed(e),a=!1,l=!1;return s.bottom&&(e=i.merge(e,{height:Math.max(e.height-s.bottom,0)}),a=!0,l=!0),s.top&&(e=i.merge(e,{y:e.y+s.top,height:e.height-s.top}),a=!0,l=!0),(a&&this.overflowBehavior==o.REFLOW||this.overflowBehavior==o.REFLOW_REPOSITION)&&(e=i.reflowVertical(t,e)),l&&this.overflowBehavior==o.REFLOW_REPOSITION&&(e=i.merge(e,{x:n(e).x})),e}performLayoutHorizontal(t,e,r,o){let n=r.overflowed(e),s=!1;return n.left&&(e=i.merge(e,{x:e.x+n.left,width:e.width-n.left}),e=i.reflowHorizontal(t,e),s=!0),n.right&&(e=i.merge(e,{width:e.width-n.right}),e=i.reflowHorizontal(t,e),s=!0),s&&(e=i.merge(e,{y:o(e).y})),e}}class a extends n{performLayoutVertical(t,e,r,o){var n,s;let a=r.overflowed(e),l=!1;return a.bottom?(e=i.merge(e,{y:e.y-a.bottom}),a=r.overflowed(e),a.top&&(l=!0)):a.top&&(e=i.merge(e,{y:e.y+a.top}),a=r.overflowed(e),a.bottom&&(l=!0)),l&&null!==(s=null===(n=this.parent)||void 0===n?void 0:n.performLayoutVertical(t,e,r,o))&&void 0!==s?s:e}performLayoutHorizontal(t,e,r,o){var n,s;let a=r.overflowed(e),l=!1;return a.left?(e=i.merge(e,{x:e.x+a.left}),a=r.overflowed(e),a.right&&(l=!0)):a.right&&(e=i.merge(e,{x:e.x-a.right}),a=r.overflowed(e),a.left&&(l=!0)),l&&null!==(s=null===(n=this.parent)||void 0===n?void 0:n.performLayoutHorizontal(t,e,r,o))&&void 0!==s?s:e}}class l{}class h extends l{createOverlayConstraint(t){return new r(t)}performLayout(t){var e,r,o;const s=t.getBoundingClientRect(),a=t.targetRect,l=t.viewportRect,h=t.behavior,d=null!==(e=h.alignment)&&void 0!==e?e:p.ALL,c=null!==(r=h.targetGap)&&void 0!==r?r:0,u=null!==(o=h.viewportPadding)&&void 0!==o?o:0,y=t=>this.perfromLayoutPosition(t,a,c),f=i.merge(s,y(s)),m=this.createOverlayConstraint(i.applyPadding(l,u));let w=f;if(d instanceof n)w=d.performLayout(t,f,m,y);else{console.assert(null!=d.horizontal),console.assert(null!=d.vertical);const e=d.horizontal.performLayoutHorizontal(t,f,m,y);w=d.vertical.performLayoutVertical(t,e,m,y)}return{initialRect:f,modifiedRect:w}}}class d extends h{perfromLayoutPosition(t,e,r){return{x:this.getPositionHorizontal(t,e,r),y:e.y+(e.height-t.height)/2}}}class c extends h{perfromLayoutPosition(t,e,r){return{x:e.x+(e.width-t.width)/2,y:this.getPositionVertical(t,e,r)}}}const u={BOTTOM_CENTER:new class extends c{getPositionVertical(t,e,r){return e.bottom+r}},BOTTOM_RIGHT:new class extends h{perfromLayoutPosition(t,e,r){return{x:e.left,y:e.bottom+r}}},BOTTOM_LEFT:new class extends h{perfromLayoutPosition(t,e,r){return{x:e.right-t.width,y:e.bottom+r}}},TOP_CENTER:new class extends c{getPositionVertical(t,e,r){return e.top-t.height-r}},TOP_RIGHT:new class extends h{perfromLayoutPosition(t,e,r){return{x:e.left,y:e.top-t.height-r}}},TOP_LEFT:new class extends h{perfromLayoutPosition(t,e,r){return{x:e.right-t.width,y:e.y-t.height-r}}},LEFT:new class extends d{getPositionHorizontal(t,e,r){return e.left-t.width-r}},RIGHT:new class extends d{getPositionHorizontal(t,e,r){return e.right+r}}},p={ALL:new a(new s),NONE:new class extends n{performLayoutVertical(t,e){return e}performLayoutHorizontal(t,e){return e}},SIZE:new s,POSITION:new a};class y{static attach({element:t,target:e,parent:r,behavior:i}){if(null==t)throw new Error("todo");if(null==e)throw new Error("todo");if(null==r)throw new Error("todo");const o=document.createElement("overlay-wrapper");return o.append(t),o.target=e,o.parent=r,o.behavior=null!=i?i:y.defaultBehavior,this.overlays.set(t,o),r.append(o),o}static at({element:t,parent:e,behavior:r,position:i}){const o=document.createElement("overlay-wrapper");return o.append(t),o.target=new DOMRect(i.x,i.y),o.parent=null!=e?e:document.body,o.behavior=null!=r?r:y.defaultBehavior,this.overlays.set(t,o),e.append(o),o}}y.overlays=new Map,y.defaultBehavior={direction:u.BOTTOM_CENTER};class f extends HTMLElement{get raw(){return this.firstElementChild}get targetRect(){return this.target instanceof HTMLElement?this.target.getBoundingClientRect():this.target}get viewportRect(){return this.parent.getBoundingClientRect()}markNeedRepaint(){this.unsetLayout(),this.performLayout()}unsetLayout(){this.style.width="max-content",this.style.height="max-content",this.style.left="0px",this.style.top="0px",this.getBoundingClientRect()}disconnectedCallback(){this.observer.disconnect(),window.removeEventListener("resize",this.markNeedRepaint.bind(this)),window.removeEventListener("scroll",this.markNeedRepaint.bind(this))}connectedCallback(){if(this.style.display="block",this.style.position="fixed",this.style.left="0px",this.style.top="0px",this.style.width="max-content",this.style.height="max-content",this.performLayout(),this.target instanceof HTMLElement){this.observer=new MutationObserver(this.markNeedRepaint.bind(this)),this.observer.observe(this.target,{attributes:!0,characterData:!0,subtree:!0,childList:!0});let t=!1;const e=()=>{t=!0,r()},r=()=>{this.markNeedRepaint(),t&&requestAnimationFrame(r)};this.target.addEventListener("animationstart",e),this.target.addEventListener("animationend",(()=>t=!1)),this.target.addEventListener("transitionstart",e),this.target.addEventListener("transitionend",(()=>t=!1))}window.addEventListener("resize",this.markNeedRepaint.bind(this)),window.addEventListener("scroll",this.markNeedRepaint.bind(this))}performLayout(){var t;const e=this.behavior.direction.performLayout(this),r=e.modifiedRect;this.style.width=`${r.width}px`,this.style.height=`${r.height}px`,this.style.left=`${r.x}px`,this.style.top=`${r.y}px`,null===(t=this.behavior.onLayoutBehind)||void 0===t||t.call(this.raw,e)}}customElements.define("overlay-wrapper",f),t.DrivenOverlayLayout=h,t.Overlay=y,t.OverlayAlignment=p,t.OverlayDirection=u,t.OverlayElement=f,t.OverlayLayout=l}));
//# sourceMappingURL=index.umd.js.map
